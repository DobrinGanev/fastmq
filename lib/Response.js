module.exports=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return null!==e&&void 0!==e&&"function"==typeof e[Symbol.iterator]}function s(e){for(var t in g)if(e===g[t])return t;return null}function u(e){var t=void 0;switch(e){case 1:t="raw";break;case 2:t="json";break;case 3:t="string";break;default:t=""}return t}function f(e){return!!g[e]}function h(e){return!!v[e]}function c(e,t){return"raw"===t?e:"json"===t?0===e.length?null:JSON.parse(e.toString("utf8")):e.toString("utf8")}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r(3),p=r(1).uuid,y=r(2),g={req:1,res:2,push:3,pull:4,pub:5,sub:6,ack:7},v={raw:1,json:2,str:3},w=function(){function e(t){if(a(this,e),"number"==typeof t)this._buf=Buffer.allocUnsafe(t);else{if(!Buffer.isBuffer(t))throw TypeError("BufferStream only accept number or Buffer type as argument");this._buf=t}this._offset=0,this._size=t.length}return l(e,[{key:"get",value:function(){return this._buf}},{key:"readUInt8",value:function(){var e=this._buf.readUInt8(this._offset);return this._offset+=1,e}},{key:"readUInt16BE",value:function(){var e=this._buf.readUInt16BE(this._offset);return this._offset+=2,e}},{key:"readUInt32BE",value:function(){var e=this._buf.readUInt32BE(this._offset);return this._offset+=4,e}},{key:"readUInt64BE",value:function(){var e=new d(this._buf,this._offset).toNumber();return this._offset+=8,e}},{key:"readString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=this._buf.toString(t,this._offset,this._offset+e);return this._offset+=e,r}},{key:"readBuffer",value:function(e){var t=this._buf.slice(this._offset,this._offset+e);return this._offset+=e,t}},{key:"writeUInt8",value:function(e){this._offset=this._buf.writeUInt8(e,this._offset)}},{key:"writeUInt16BE",value:function(e){this._offset=this._buf.writeUInt16BE(e,this._offset)}},{key:"writeUInt32BE",value:function(e){this._offset=this._buf.writeUInt32BE(e,this._offset)}},{key:"writeUInt64BE",value:function(e){new d(e).copy(this._buf,this._offset),this._offset+=8}},{key:"writeString",value:function(e,t){void 0===t&&(t=e.length),this._offset+=this._buf.write(e,this._offset,t)}},{key:"writeBuffer",value:function(e,t,r){this._offset+=e.copy(this._buf,this._offset,t,r)}},{key:"readHeaderString",value:function(){var e=this.readUInt8();return this.readString(e)}},{key:"writeHeaderString",value:function(e,t){void 0===t&&(t=Buffer.byteLength(e)),this.writeUInt8(t),this.writeString(e,t)}},{key:"offset",get:function(){return this._offset},set:function(e){this._offset=e}}]),e}(),_=function(){function e(t,r,n,i){a(this,e),this.messageLength=n||0,this.headerLength=i||0,this.header={id:r||p()},this.payload=void 0,this.payloadBuf=void 0,t&&this.setType(t)}return l(e,[{key:"isRequest",value:function(){return"req"===this.header.type}},{key:"isResponse",value:function(){return"res"===this.header.type}},{key:"isPush",value:function(){return"push"===this.header.type}},{key:"isPull",value:function(){return"pull"===this.header.type}},{key:"isPublish",value:function(){return"pub"===this.header.type}},{key:"isSubscribe",value:function(){return"sub"===this.header.type}},{key:"isAck",value:function(){return"ack"===this.header.type}},{key:"getEventName",value:function(){return this.header.topic+"."+this.header.id}},{key:"setType",value:function(e){if(!f(e))throw new TypeError("Invalid message type: "+e);this.header.type=e}},{key:"setContentType",value:function(e){if(!h(e))throw new TypeError("Invalid message content type: "+e);this.header.contentType=e}},{key:"setPayload",value:function(e,t){t?this.header.contentType=t:t=this.header.contentType,this.payload=e}},{key:"setPayloadBuf",value:function(e){this.payloadBuf=e}},{key:"getBuffer",value:function(){var e=this._getHeaderBuffer();this.headerLength=e.length,this.messageLength=8+this.headerLength,!this.payloadBuf&&this.payload&&(this.payloadBuf=this._getPayloadBuffer()),this.payloadBuf&&(this.messageLength+=this.payloadBuf.length);var t=Buffer.allocUnsafe(this.messageLength);return t.writeUInt32BE(this.messageLength),t.writeUInt32BE(this.headerLength,4),e.copy(t,8),this.payloadBuf&&this.payloadBuf.copy(t,8+this.headerLength),t}},{key:"_getPayloadBuffer",value:function(){var e=this.payload,t=this.header.contentType,r=void 0;if(!h(t))throw new TypeError("Unknown payload content type: "+t);return"raw"===t?r=Buffer.isBuffer(e)?e:Buffer.from(e):"json"===t?r=Buffer.from(JSON.stringify(e),"utf8"):"string"===t&&(r=Buffer.from(e)),r}}]),e}(),B=function(e){function t(e,r,i){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"req",e,r,i))}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);return r.offset=9,this.header.contentType=u(r.readUInt8()),this.header.error=r.readUInt8(),this.header.topic=r.readHeaderString(),this.header.source=r.readHeaderString(),this.header.target=r.readHeaderString(),this.payloadBuf=e.slice(8+this.headerLength,this.messageLength),this.payload=c(this.payloadBuf,this.header.contentType),this}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=Buffer.byteLength(e.source,"utf8"),n=Buffer.byteLength(e.target,"utf8"),i=14+t+r+n,a=Buffer.alloc(i),o=new w(a);return o.writeUInt64BE(e.id),o.writeUInt8(g[e.type]),o.writeUInt8(v[e.contentType]),o.writeUInt8(e.error||0),o.writeHeaderString(e.topic,t),o.writeHeaderString(e.source,r),o.writeHeaderString(e.target,n),o.get()}},{key:"setTopic",value:function(e){this.header.topic=e}},{key:"setSource",value:function(e){this.header.source=e}},{key:"setTarget",value:function(e){this.header.target=e}}]),t}(_),b=function(e){function t(e,r,i){a(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));return o.header.type="res",o}return i(t,e),l(t,[{key:"isError",value:function(e){var t=y[e];return void 0!==t&&this.header.error===t}},{key:"setError",value:function(e){if("number"!=typeof e)throw new TypeError("Invalid message error code: "+e);this.header.error=e}}]),t}(B),k=function(e){function t(e,r,i){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"pub",e,r,i))}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);return r.offset=9,this.header.contentType=u(r.readUInt8()),this.header.topic=r.readHeaderString(),this.header.target=r.readHeaderString(),this.payloadBuf=e.slice(8+this.headerLength,this.messageLength),this}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=Buffer.byteLength(e.target,"utf8"),n=12+t+r,i=Buffer.alloc(n),a=new w(i);return a.writeUInt64BE(e.id),a.writeUInt8(g[e.type]),a.writeUInt8(v[e.contentType]),a.writeHeaderString(e.topic,t),a.writeHeaderString(e.target,r),a.get()}},{key:"setTopic",value:function(e){this.header.topic=e}},{key:"setTarget",value:function(e){this.header.target=e}}]),t}(_),m=function(e){function t(e,r,i){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"sub",e,r,i))}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);return r.offset=9,this.header.contentType=u(r.readUInt8()),this.header.topic=r.readHeaderString(),this.payloadBuf=e.slice(8+this.headerLength,this.messageLength),this.payload=c(this.payloadBuf,this.header.contentType),this}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=11+t,n=Buffer.alloc(r),i=new w(n);return i.writeUInt64BE(e.id),i.writeUInt8(g[e.type]),i.writeUInt8(v[e.contentType]),i.writeHeaderString(e.topic,t),i.get()}},{key:"setTopic",value:function(e){this.header.topic=e}}]),t}(_),I=function(e){function t(e,r,i){a(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"push",e,r,i));return o.payload=[],o.items=[],o}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);r.offset=9,this.header.contentType=u(r.readUInt8()),this.header.topic=r.readHeaderString(),this.header.target=r.readHeaderString(),this.header.itemCount=r.readUInt32BE();var n=e.slice(8+this.headerLength,this.messageLength);return this.items=this._splitPayloadToItems(n),this}},{key:"_splitPayloadToItems",value:function(e){for(var t=this.header.itemCount,r=e.length,n=new w(e),i=[],a=0;a<t;a++){var o=n.readUInt32BE();if(n.offset+o>r)throw new RangeError("Payload buffer is smaller than expected.");var s=n.readBuffer(o);i.push(s)}return i}},{key:"_parsePayloadBuffer",value:function(e,t){var r=this.header.itemCount,n=e.length,i=new w(e),a=[];if("raw"===t)for(var o=0;o<r;o++){var s=i.readUInt32BE();if(i.offset+s>n)throw new RangeError("Payload buffer is smaller than expected.");var u=i.readBuffer(s);a.push(u)}else if("json"===t){if(r<1||0===e.length)return[];for(var f=0;f<r;f++){var h=i.readUInt32BE();if(i.offset+h>n)throw new RangeError("Payload buffer is smaller than expected.");var c=i.readBuffer(h);a.push(JSON.parse(c.toString("utf8")))}}else for(var l=0;l<r;l++){var d=i.readUInt32BE();if(i.offset+d>n)throw new RangeError("Payload buffer is smaller than expected.");var p=i.readBuffer(d);a.push(p.toString("utf8"))}this.payload=a}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=Buffer.byteLength(e.target,"utf8"),n=16+t+r,i=Buffer.alloc(n),a=new w(i);return a.writeUInt64BE(e.id),a.writeUInt8(g[e.type]),a.writeUInt8(v[e.contentType]),a.writeHeaderString(e.topic,t),a.writeHeaderString(e.target,r),a.writeUInt32BE(e.itemCount),a.get()}},{key:"_getPayloadBuffer",value:function(){var e=this.payload,t=this.header.contentType;if(!h(t))throw new TypeError("Unknown payload content type: "+t);if(!o(e))throw new TypeError("payload should be an iterable object.");if(e.length!==this.header.itemCount)throw new TypeError("payload length should be equal to itemCount.");var r=[];if("raw"===t)for(var n in e){var i=e[n],a=Buffer.isBuffer(i)?i:Buffer.from(i),s=Buffer.allocUnsafe(a.length+4);s.writeUInt32BE(a.length,0),a.copy(s,4),r.push(s)}else if("json"===t)for(var u in e){var f=e[u],c=Buffer.from(JSON.stringify(f),"utf8"),l=Buffer.allocUnsafe(c.length+4);l.writeUInt32BE(c.length,0),c.copy(l,4),r.push(l)}else if("string"===t)for(var d in e){var p=e[d],y=Buffer.from(p),g=Buffer.allocUnsafe(y.length+4);g.writeUInt32BE(y.length,0),y.copy(g,4),r.push(g)}return Buffer.concat(r)}},{key:"setTopic",value:function(e){this.header.topic=e}},{key:"setTarget",value:function(e){this.header.target=e}},{key:"setItemCount",value:function(e){this.header.itemCount=e}},{key:"setPayload",value:function(e,t){if(!o(e))throw new TypeError("payload should be an iterable object.");t?this.header.contentType=t:t=this.header.contentType,this.payload=e,this.header.itemCount=e.length}}]),t}(_),T=function(e){function t(e,r,i){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"pull",e,r,i))}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);r.offset=9,this.header.contentType=u(r.readUInt8()),this.header.topic=r.readHeaderString();var n=e.slice(8+this.headerLength,this.messageLength);return this.payload=c(n,this.header.contentType),this}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=11+t,n=Buffer.alloc(r),i=new w(n);return i.writeUInt64BE(e.id),i.writeUInt8(g[e.type]),i.writeUInt8(v[e.contentType]),i.writeHeaderString(e.topic,t),i.get()}},{key:"setTopic",value:function(e){this.header.topic=e}}]),t}(_),U=function(e){function t(e,r,i){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ack",e,r,i))}return i(t,e),l(t,[{key:"createFromBuffer",value:function(e){var t=e.slice(8,8+this.headerLength),r=new w(t);return r.offset=9,this.header.topic=r.readHeaderString(),this}},{key:"_getHeaderBuffer",value:function(){var e=this.header,t=Buffer.byteLength(e.topic,"utf8"),r=10+t,n=Buffer.alloc(r),i=new w(n);return i.writeUInt64BE(e.id),i.writeUInt8(g[e.type]),i.writeHeaderString(e.topic,t),i.get()}},{key:"setTopic",value:function(e){this.header.topic=e}}]),t}(_);t.create=function(e,t){if("req"===e)return new B(t);if("res"===e)return new b(t);if("push"===e)return new I(t);if("pull"===e)return new T(t);if("pub"===e)return new k(t);if("sub"===e)return new m(t);if("ack"===e)return new U(t);throw new TypeError("Message type:"+e+" is not valid.")},t.createFromBuffer=function(e){var t=e.readUInt32BE(0),r=e.readUInt32BE(4),n=new d(e,8).toNumber(),i=s(e.readUInt8(16,!0)),a=void 0;if("req"===i)a=new B(n,t,r);else if("res"===i)a=new b(n,t,r);else if("push"===i)a=new I(n,t,r);else if("pull"===i)a=new T(n,t,r);else if("pub"===i)a=new k(n,t,r);else if("sub"===i)a=new m(n,t,r);else{if("ack"!==i)throw new TypeError("Message type:"+i+" is not valid.");a=new U(n,t,r)}return a.createFromBuffer(e),a}},function(e,t,r){"use strict";function n(){var e=Date.now(),t=n.last||e;return n.last=e>t?o+e:o+t+1,n.last}var i=r(4),a=r(5);t.toNumber=function(e){return(e=Number(e))>=0&&e},t.getSocketPath=function(e){var t=i.resolve(a.tmpdir(),".fast.mq."+e);return"win32"===process.platform&&(t=i.replace(/^\//,""),t=i.replace(/\//g,"-"),t="\\\\.\\pipe\\"+t),t};var o=process&&process.pid?process.pid:0;t.uuid=n},function(e,t,r){"use strict";e.exports={REGISTER_FAIL:1,TARGET_CHANNEL_NONEXIST:2,TOPIC_NONEXIST:3}},function(e,t){e.exports=require("node-int64")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("os")},,function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=function(){function e(t,r){n(this,e),this._reqMsg=t,this.socket=r,this._msg=a.create("res",t.header.id);var i=t.header;this._msg.setTopic(i.topic),this._msg.setSource(i.target),this._msg.setTarget(i.source),this._msg.setContentType(i.contentType)}return i(e,[{key:"header",value:function(e){return void 0===e?this._msg.header:this._msg.header[e]}},{key:"setSource",value:function(e){this._msg.setSource(e)}},{key:"setTarget",value:function(e){this._msg.setTarget(e)}},{key:"setError",value:function(e){this._msg.setError(e)}},{key:"setContentType",value:function(e){this._msg.setContentType(e)}},{key:"send",value:function(e,t){t&&this._msg.setContentType(t),this._msg.setPayload(e),this.socket.write(this._msg.getBuffer())}}]),e}();e.exports=o}]);